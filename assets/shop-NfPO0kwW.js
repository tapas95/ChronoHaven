import{c as x,d as b,g as L,e as $,f as q,h as I,q as w,w as A}from"./firebase-config-DD6-ao-H.js";import{g as P,u as j}from"./header-CYxULnqH.js";import{r as H,a as M,S as B}from"./productCardSkeleton-CP-Wy3Cy.js";import{d as m}from"./alert-CO0lNkg5.js";const F=(o,t)=>{const r=typeof o=="string"?document.querySelector(o):o;if(!r)return;const n=()=>`
        <span class="placeholder col-5 d-block rounded-32" style="height: 2.5rem;"></span>
    `,e=document.createElement("li");e.className="w-100 d-flex gap-2 flex-wrap mb-0",e.id="categorySkeletonContainer";for(let a=0;a<t;a++)e.insertAdjacentHTML("beforeend",n());r.appendChild(e)},N=async o=>{F(o,5);try{const t=x(b,"collections","categories","items"),r=await L(t);if(r.empty){o.insertAdjacentHTML("beforeend",m("No Categories Found.","danger"));return}r.forEach(n=>{const e=n.data();o.insertAdjacentHTML("beforeend",`
                <li class="mb-0">
                    <label for="${e.id}" class="px-3 py-2 border rounded-32 transition-3 cursor-pointer">
                        <input type="checkbox" id="${e.id}" name="${e.id}" data-category="${e.name}" class="category-checkbox d-none" />
                        <span class="d-block">${e.name}</span>
                    </label>
                </li>
            `)})}catch(t){console.log(t)}finally{const t=document.getElementById("categorySkeletonContainer");t&&t.remove()}},_=async(o,t,r)=>{try{const n=await P();if(n){const e=`${o}_${t}`,a=$(b,"users",n.uid,"cart",e);return(await q(a)).exists()?"EXISTS":(await I(a,{productId:o,variantId:t,quantity:r}),"ADDED")}else{let e=JSON.parse(localStorage.getItem("guestCart"))||[];return e.some(d=>d.productId===o&&d.variantId===t)?"EXISTS":(e.push({productId:o,variantId:t,quantity:r}),localStorage.setItem("guestCart",JSON.stringify(e)),"ADDED")}}catch(n){throw console.log(n),n}},p=document.getElementById("productsContainer"),C=document.getElementById("categoriesContainer"),E=async(o=null,t=null)=>{p.innerHTML="",H(p,9);try{let r=x(b,"collections","products","items");if(o&&o.length>0&&(r=w(r,A("category","in",o))),t){const[e,a]=t;r=w(r,A("price",">=",e),A("price","<=",a))}const n=await L(r);if(n.empty){p.insertAdjacentHTML("beforeend",m("No Products Found.","danger"));return}n.forEach(e=>{const a=e.data();p.insertAdjacentHTML("beforeend",M(a))}),requestAnimationFrame(()=>{const e=document.querySelectorAll(".variant-images"),a=document.querySelectorAll(".product-title"),d=document.querySelectorAll(".add-to-cart");d.forEach(s=>{s.addEventListener("click",u=>{u.preventDefault(),document.querySelectorAll(".alert").forEach(c=>c.remove()),s.disabled=!0,s.insertAdjacentHTML("beforeend",'<div class="spinner-border spinner-border-sm text-light" role="status"><span class="visually-hidden">Loading...</span></div>');const y=s.getAttribute("data-product-id"),l=s.getAttribute("data-variant-id");y&&l?_(y,l,1).then(c=>{c==="ADDED"?(s.parentElement.insertAdjacentHTML("afterend",m("Product Added To Cart","success","bi-check-circle-fill","fs-xs")),j()):c==="EXISTS"&&s.parentElement.insertAdjacentHTML("afterend",m("Product Already Exist","danger","bi-exclamation-diamond-fill","fs-xs"))}).catch(c=>{console.log("Failed to add to cart",c)}).finally(()=>{s.disabled=!1;const c=s.querySelector(".spinner-border");c&&c.remove()}):console.warn("Product or Variant ID missing")})}),e.forEach((s,u)=>{var c;new B(s,{perPage:1,arrows:!1,pagination:!0,drag:!1}).mount();const l=(c=n.docs[u])==null?void 0:c.data();if(!l||!l.variants)return;const k=s.querySelectorAll(".splide__pagination__page");l.variants.forEach((i,v)=>{const f=k[v];if(!f||!i.colors)return;const D=i.colors.map(g=>i.colors.length>1?`${g} ${100/i.colors.length}%`:g).join(", ");f.style.cssText=`
                        --variant-base-color: ${i.colors[0]};
                        background-image: linear-gradient( -45deg, ${D} );
                        box-shadow: 0 0 0 0.125rem ${i.colors[0]};
                    `,f.setAttribute("data-variant-id",`${i.id}`),f.addEventListener("click",()=>{const g=i.id,h=a[u],T=d[u];if(!h||!T)return;const S=new URL(h.href,window.location.origin);S.searchParams.delete("variantId"),S.searchParams.append("variantId",g),h.href=S.toString(),T.setAttribute("data-variant-id",`${g}`)})})})})}catch(r){console.log(r),p.insertAdjacentHTML("beforeend",m("Error Loading Products.","danger"))}finally{const r=document.getElementById("productCardSkeleton");r&&r.remove()}};E();C&&N(C).then(()=>{const o=C.querySelectorAll("input.category-checkbox");o.forEach(t=>{t.addEventListener("change",r=>{r.preventDefault(),t.getAttribute("data-category");const n=Array.from(o).filter(e=>e.checked).map(e=>e.getAttribute("data-category"));t.checked?t.parentElement.classList.add("bg-primary","text-white"):t.parentElement.classList.remove("bg-primary","text-white"),n.length===0?E(null):E(n)})})});
