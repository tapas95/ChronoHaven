import{c as H,d as M,g as F,a as g,q as x,w as T}from"./alert-DWjb4CXO.js";import{u as $}from"./header-C8m5pGcf.js";import{r as j,a as D,c as C,b as B,S as _}from"./checkIsFavorite-B8pEgNP4.js";import{a as N}from"./addToCart-BiXPYAeh.js";const R=(o,a)=>{const r=typeof o=="string"?document.querySelector(o):o;if(!r)return;const c=()=>`
        <span class="placeholder col-5 d-block rounded-32" style="height: 2.5rem;"></span>
    `,t=document.createElement("li");t.className="w-100 d-flex gap-2 flex-wrap mb-0",t.id="categorySkeletonContainer";for(let d=0;d<a;d++)t.insertAdjacentHTML("beforeend",c());r.appendChild(t)},V=async o=>{R(o,5);try{const a=H(M,"collections","categories","items"),r=await F(a);if(r.empty){o.insertAdjacentHTML("beforeend",g("No Categories Found.","danger"));return}r.forEach(c=>{const t=c.data();o.insertAdjacentHTML("beforeend",`
                <li class="mb-0">
                    <label for="${t.id}" class="px-3 py-2 border rounded-32 transition-3 cursor-pointer">
                        <input type="checkbox" id="${t.id}" name="${t.id}" data-category="${t.name}" class="category-checkbox d-none" />
                        <span class="d-block">${t.name}</span>
                    </label>
                </li>
            `)})}catch(a){console.log(a)}finally{const a=document.getElementById("categorySkeletonContainer");a&&a.remove()}},m=document.getElementById("productsContainer"),k=document.getElementById("categoriesContainer"),S=async(o=null,a=null)=>{m.innerHTML="",j(m,9);try{let r=H(M,"collections","products","items");if(o&&o.length>0&&(r=x(r,T("category","in",o))),a){const[t,d]=a;r=x(r,T("price",">=",t),T("price","<=",d))}const c=await F(r);if(c.empty){m.insertAdjacentHTML("beforeend",g("No Products Found."));return}c.forEach(t=>{const d=t.data();m.insertAdjacentHTML("beforeend",D(d))}),requestAnimationFrame(()=>{(async()=>{const t=document.querySelectorAll(".variant-images"),d=document.querySelectorAll(".product-title"),E=document.querySelectorAll(".add-to-cart"),v=document.querySelectorAll(".add-to-favorite");if(E.forEach(e=>{e.addEventListener("click",l=>{l.preventDefault(),document.querySelectorAll(".alert").forEach(n=>n.remove()),e.disabled=!0,e.insertAdjacentHTML("beforeend",'<div class="spinner-border spinner-border-sm text-light" role="status"><span class="visually-hidden">Loading...</span></div>');const f=e.getAttribute("data-product-id"),i=e.getAttribute("data-variant-id");f&&i?N(f,i,1).then(n=>{n==="ADDED"?(e.parentElement.insertAdjacentHTML("afterend",g("Product Added To Cart","success","fs-xs")),$()):n==="EXISTS"&&e.parentElement.insertAdjacentHTML("afterend",g("Product Already Exist","danger","fs-xs"))}).catch(n=>{console.log("Failed to add to cart",n)}).finally(()=>{e.disabled=!1;const n=e.querySelector(".spinner-border");n&&n.remove()}):console.warn("Product or Variant ID missing")})}),v)for(const e of v){const l=e.getAttribute("data-product-id"),f=e.getAttribute("data-variant-id");try{await C(l,f)&&(e.classList.add("bg-primary","text-white"),e.innerHTML=`
                                    <svg width="18" height="18" class="d-block flex-shrink-0">
                                        <use href="./src/assets/images/sprite.svg#heartFill"></use>
                                    </svg>
                                `)}catch(i){console.log(i)}e.addEventListener("click",async i=>{i.preventDefault(),document.querySelectorAll(".alert").forEach(s=>s.remove()),e.disabled=!0,e.innerHTML='<div class="spinner-border spinner-border-sm text-primary" role="status"><span class="visually-hidden">Loading...</span></div>';const h=e.getAttribute("data-product-id"),n=e.getAttribute("data-variant-id");try{const s=await B({productId:h,variantId:n});s==="ADDED"?(e.parentElement.insertAdjacentHTML("afterend",g("Product Added To Favorites","success")),e.classList.add("bg-primary","text-white"),e.innerHTML=`
                                        <svg width="18" height="18" class="d-block flex-shrink-0">
                                            <use href="./src/assets/images/sprite.svg#heartFill"></use>
                                        </svg>
                                    `):s==="EXISTS"&&(e.parentElement.insertAdjacentHTML("afterend",g("Product Already Added To Favorites","danger")),e.innerHTML=`
                                        <svg width="18" height="18" class="d-block flex-shrink-0">
                                            <use href="./src/assets/images/sprite.svg#heartFill"></use>
                                        </svg>
                                    `)}catch(s){console.log(s)}finally{e.disabled=!1}})}t.forEach((e,l)=>{var n;new _(e,{perPage:1,arrows:!1,pagination:!0,drag:!1}).mount();const i=(n=c.docs[l])==null?void 0:n.data();if(!i||!i.variants)return;const h=e.querySelectorAll(".splide__pagination__page");i.variants.forEach((s,I)=>{const y=h[I];if(!y||!s.colors)return;const q=s.colors.map(u=>s.colors.length>1?`${u} ${100/s.colors.length}%`:u).join(", ");y.style.cssText=`
                            --variant-base-color: ${s.colors[0]};
                            background-image: linear-gradient( -45deg, ${q} );
                            box-shadow: 0 0 0 0.125rem ${s.colors[0]};
                        `,y.setAttribute("data-variant-id",`${s.id}`),y.addEventListener("click",()=>{const u=s.id,b=d[l],w=E[l],p=v[l];if(!b||!w)return;const A=new URL(b.href,window.location.origin);A.searchParams.delete("variantId"),A.searchParams.append("variantId",u),b.href=A.toString(),w.setAttribute("data-variant-id",`${u}`),p.setAttribute("data-variant-id",`${u}`);const P=p.getAttribute("data-product-id");C(P,u).then(L=>{L?(p.classList.add("bg-primary","text-white"),p.innerHTML=`
                                        <svg width="18" height="18" class="d-block flex-shrink-0">
                                            <use href="./src/assets/images/sprite.svg#heartFill"></use>
                                        </svg>
                                    `):(p.classList.remove("bg-primary","text-white"),p.innerHTML=`
                                        <svg width="18" height="18" class="d-block flex-shrink-0">
                                            <use href="./src/assets/images/sprite.svg#heart"></use>
                                        </svg>
                                    `)}).catch(L=>{console.log(L)})})})})})()})}catch(r){console.log(r),m.insertAdjacentHTML("beforeend",g("Error Loading Products."))}finally{const r=document.getElementById("productCardSkeleton");r&&r.remove()}};S();k&&V(k).then(()=>{const o=k.querySelectorAll("input.category-checkbox");o.forEach(a=>{a.addEventListener("change",r=>{r.preventDefault(),a.getAttribute("data-category");const c=Array.from(o).filter(t=>t.checked).map(t=>t.getAttribute("data-category"));a.checked?a.parentElement.classList.add("bg-primary","text-white"):a.parentElement.classList.remove("bg-primary","text-white"),c.length===0?S(null):S(c)})})});
