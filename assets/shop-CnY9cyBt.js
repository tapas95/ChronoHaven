import{c as C,d as w,g as x,q as k,w as A}from"./firebase-config-C_Yz0m2T.js";import{u as M}from"./header-Ck-m_ind.js";import{r as q,a as P,b as $,S as j}from"./addToCart-I0CFUIh4.js";import{d as u}from"./alert-DsZaPul3.js";import{c as D,a as B}from"./addToFavorites-BJtZKf8r.js";const _=(n,a)=>{const r=typeof n=="string"?document.querySelector(n):n;if(!r)return;const d=()=>`
        <span class="placeholder col-5 d-block rounded-32" style="height: 2.5rem;"></span>
    `,t=document.createElement("li");t.className="w-100 d-flex gap-2 flex-wrap mb-0",t.id="categorySkeletonContainer";for(let c=0;c<a;c++)t.insertAdjacentHTML("beforeend",d());r.appendChild(t)},N=async n=>{_(n,5);try{const a=C(w,"collections","categories","items"),r=await x(a);if(r.empty){n.insertAdjacentHTML("beforeend",u("No Categories Found.","danger"));return}r.forEach(d=>{const t=d.data();n.insertAdjacentHTML("beforeend",`
                <li class="mb-0">
                    <label for="${t.id}" class="px-3 py-2 border rounded-32 transition-3 cursor-pointer">
                        <input type="checkbox" id="${t.id}" name="${t.id}" data-category="${t.name}" class="category-checkbox d-none" />
                        <span class="d-block">${t.name}</span>
                    </label>
                </li>
            `)})}catch(a){console.log(a)}finally{const a=document.getElementById("categorySkeletonContainer");a&&a.remove()}},f=document.getElementById("productsContainer"),S=document.getElementById("categoriesContainer"),T=async(n=null,a=null)=>{f.innerHTML="",q(f,9);try{let r=C(w,"collections","products","items");if(n&&n.length>0&&(r=k(r,A("category","in",n))),a){const[t,c]=a;r=k(r,A("price",">=",t),A("price","<=",c))}const d=await x(r);if(d.empty){f.insertAdjacentHTML("beforeend",u("No Products Found."));return}d.forEach(t=>{const c=t.data();f.insertAdjacentHTML("beforeend",P(c))}),requestAnimationFrame(()=>{(async()=>{const t=document.querySelectorAll(".variant-images"),c=document.querySelectorAll(".product-title"),E=document.querySelectorAll(".add-to-cart"),y=document.querySelectorAll(".add-to-favorite");if(E.forEach(e=>{e.addEventListener("click",l=>{l.preventDefault(),document.querySelectorAll(".alert").forEach(s=>s.remove()),e.disabled=!0,e.insertAdjacentHTML("beforeend",'<div class="spinner-border spinner-border-sm text-light" role="status"><span class="visually-hidden">Loading...</span></div>');const g=e.getAttribute("data-product-id"),i=e.getAttribute("data-variant-id");g&&i?$(g,i,1).then(s=>{s==="ADDED"?(e.parentElement.insertAdjacentHTML("afterend",u("Product Added To Cart","success","fs-xs")),M()):s==="EXISTS"&&e.parentElement.insertAdjacentHTML("afterend",u("Product Already Exist","danger","fs-xs"))}).catch(s=>{console.log("Failed to add to cart",s)}).finally(()=>{e.disabled=!1;const s=e.querySelector(".spinner-border");s&&s.remove()}):console.warn("Product or Variant ID missing")})}),y)for(const e of y){const l=e.getAttribute("data-product-id"),g=e.getAttribute("data-variant-id");try{await D(l,g)&&(e.classList.add("bg-primary","text-white"),e.innerHTML=`
                                    <svg width="18" height="18" class="d-block flex-shrink-0">
                                        <use href="./src/assets/images/sprite.svg#heartFill"></use>
                                    </svg>
                                `)}catch(i){console.log(i)}e.addEventListener("click",async i=>{i.preventDefault(),document.querySelectorAll(".alert").forEach(o=>o.remove()),e.disabled=!0,e.innerHTML='<div class="spinner-border spinner-border-sm text-primary" role="status"><span class="visually-hidden">Loading...</span></div>';const m=e.getAttribute("data-product-id"),s=e.getAttribute("data-variant-id");try{const o=await B({productId:m,variantId:s});o==="ADDED"?(e.parentElement.insertAdjacentHTML("afterend",u("Product Added To Favorites","success")),e.classList.add("bg-primary","text-white"),e.innerHTML=`
                                        <svg width="18" height="18" class="d-block flex-shrink-0">
                                            <use href="./src/assets/images/sprite.svg#heartFill"></use>
                                        </svg>
                                    `):o==="EXISTS"&&(e.parentElement.insertAdjacentHTML("afterend",u("Product Already Added To Favorites","danger")),e.innerHTML=`
                                        <svg width="18" height="18" class="d-block flex-shrink-0">
                                            <use href="./src/assets/images/sprite.svg#heartFill"></use>
                                        </svg>
                                    `)}catch(o){console.log(o)}finally{e.disabled=!1}})}t.forEach((e,l)=>{var s;new j(e,{perPage:1,arrows:!1,pagination:!0,drag:!1}).mount();const i=(s=d.docs[l])==null?void 0:s.data();if(!i||!i.variants)return;const m=e.querySelectorAll(".splide__pagination__page");i.variants.forEach((o,F)=>{const h=m[F];if(!h||!o.colors)return;const H=o.colors.map(p=>o.colors.length>1?`${p} ${100/o.colors.length}%`:p).join(", ");h.style.cssText=`
                            --variant-base-color: ${o.colors[0]};
                            background-image: linear-gradient( -45deg, ${H} );
                            box-shadow: 0 0 0 0.125rem ${o.colors[0]};
                        `,h.setAttribute("data-variant-id",`${o.id}`),h.addEventListener("click",()=>{const p=o.id,v=c[l],L=E[l],I=y[l];if(!v||!L)return;const b=new URL(v.href,window.location.origin);b.searchParams.delete("variantId"),b.searchParams.append("variantId",p),v.href=b.toString(),L.setAttribute("data-variant-id",`${p}`),I.setAttribute("data-variant-id",`${p}`)})})})})()})}catch(r){console.log(r),f.insertAdjacentHTML("beforeend",u("Error Loading Products."))}finally{const r=document.getElementById("productCardSkeleton");r&&r.remove()}};T();S&&N(S).then(()=>{const n=S.querySelectorAll("input.category-checkbox");n.forEach(a=>{a.addEventListener("change",r=>{r.preventDefault(),a.getAttribute("data-category");const d=Array.from(n).filter(t=>t.checked).map(t=>t.getAttribute("data-category"));a.checked?a.parentElement.classList.add("bg-primary","text-white"):a.parentElement.classList.remove("bg-primary","text-white"),d.length===0?T(null):T(d)})})});
