import{c as I,d as p,g as b,b as d,u as v,i as E,s as w,a as i,e as L,f as y,G as P,h as A,j as C}from"./alert-CXZLJFli.js";/* empty css                       */import{t as N}from"./togglePasswordVisibility-CFsXdpQZ.js";const h=async s=>{try{const e=JSON.parse(localStorage.getItem("guestCart"))||[];if(!e.length)return;const a=I(p,"users",s,"cart"),n=await b(a),c=[];n.forEach(t=>{const o=t.data();c.push({id:t.id,...o})});for(const t of e){const o=c.find(r=>r.productId===t.productId&&(r.variantId||null)===(t.variantId||null));if(o){const r=d(a,o.id);await v(r,{quantity:E(t.quantity)})}else{const r=d(a);await w(r,{productId:t.productId,quantity:t.quantity,variantId:t.variantId||null})}}localStorage.removeItem("guestCart")}catch(e){console.error("Failed to sync guest cart to user:",e)}},l=document.getElementById("loginForm"),u=document.getElementById("email"),m=document.getElementById("password"),g=document.getElementById("submitLogin");N("passwordVisibility","password");l.addEventListener("submit",async s=>{s.preventDefault(),document.querySelectorAll(".alert").forEach(n=>n.remove());const e=u.value.trim(),a=m.value.trim();if(!e)return u.insertAdjacentHTML("afterend",i("Please Enter Email Address"));if(!a)return m.parentElement.insertAdjacentHTML("afterend",i("Please Enter Password"));g.disabled=!0;try{const n=await L(y,e,a);l.innerHTML=i("Signed in successfully. Redirecting now.","success"),await h(n.user.uid),setTimeout(()=>{window.location.href="./"},1e3)}catch(n){switch(n.code){case"auth/invalid-credential":l.insertAdjacentHTML("afterbegin",i("Invalid Email or Password","danger","mb-3"));break;case"auth/network-request-failed":l.insertAdjacentHTML("afterbegin",i("Network error: Please check your internet connection and try again.","danger","mb-3"));break}}finally{g.disabled=!1}});const f=document.getElementById("loginWithGoogle"),S=new P;f&&f.addEventListener("click",async()=>{try{const e=(await A(y,S)).user,a=d(p,"users",e.uid);if(!(await C(a)).exists()){const t=(e.displayName||"Guest").split(" ");await w(a,{firstName:t[0],lastName:t[1],email:e.email,phone:e.phoneNumber||null,avatar:e.photoURL,gender:"Other"})}await h(e.uid),window.location.href="./"}catch(s){console.error("‚ùå Google login failed:",s.code,s.message),alert("Google login failed: "+s.message)}});
