import{c as de,d as ne,q as ce,w as le,g as ue,a as v,b as me,e as ge}from"./alert-DWjb4CXO.js";import{u as re}from"./header-C8m5pGcf.js";import{r as pe,a as fe,c as M,b as se,S as j}from"./checkIsFavorite-B8pEgNP4.js";import{a as ae}from"./addToCart-BiXPYAeh.js";const ve=async(n,i,u)=>{pe(u,3);try{const r=de(ne,"collections","products","items"),c=ce(r,le("category","==",i)),l=await ue(c);if(l.empty){u.insertAdjacentHTML("beforeend",v("No Products Found.","danger"));return}const m=[];l.forEach(e=>{const a=e.data();a.id!==n&&(m.push(a),u.insertAdjacentHTML("beforeend",fe(a)))}),m.length===0&&u.insertAdjacentHTML("beforeend",v("No related products found.","danger","bi-exclamation-diamond-fill","mx-2")),requestAnimationFrame(()=>{(async()=>{const e=document.querySelectorAll(".variant-images"),a=document.querySelectorAll(".product-title"),b=document.querySelectorAll(".add-to-cart"),T=document.querySelectorAll(".add-to-favorite");if(b.forEach(t=>{t.addEventListener("click",s=>{s.preventDefault(),document.querySelectorAll(".alert").forEach(o=>o.remove()),t.disabled=!0,t.insertAdjacentHTML("beforeend",'<div class="spinner-border spinner-border-sm text-light" role="status"><span class="visually-hidden">Loading...</span></div>');const d=t.getAttribute("data-product-id"),g=t.getAttribute("data-variant-id");d&&g?ae(d,g,1).then(o=>{o==="ADDED"?(t.parentElement.insertAdjacentHTML("afterend",v("Product Added To Cart","success","bi-check-circle-fill","fs-xs")),re()):o==="EXISTS"&&t.parentElement.insertAdjacentHTML("afterend",v("Product Already Exist","danger","bi-exclamation-diamond-fill","fs-xs"))}).catch(o=>{console.log("Failed to add to cart",o)}).finally(()=>{t.disabled=!1;const o=t.querySelector(".spinner-border");o&&o.remove()}):console.warn("Product or Variant ID missing")})}),T)for(const t of T){const s=t.getAttribute("data-product-id"),d=t.getAttribute("data-variant-id");try{await M(s,d)&&(t.classList.add("bg-primary","text-white"),t.innerHTML=`
                                    <svg width="18" height="18" class="d-block flex-shrink-0">
                                        <use href="./src/assets/images/sprite.svg#heartFill"></use>
                                    </svg>
                                `)}catch(g){console.log(g)}t.addEventListener("click",async g=>{g.preventDefault(),document.querySelectorAll(".alert").forEach(f=>f.remove()),t.disabled=!0,t.innerHTML='<div class="spinner-border spinner-border-sm text-primary" role="status"><span class="visually-hidden">Loading...</span></div>';const p=t.getAttribute("data-product-id"),o=t.getAttribute("data-variant-id");try{const f=await se({productId:p,variantId:o});f==="ADDED"?(t.parentElement.insertAdjacentHTML("afterend",v("Product Added To Favorites","success")),t.classList.add("bg-primary","text-white"),t.innerHTML=`
                                        <svg width="18" height="18" class="d-block flex-shrink-0">
                                            <use href="./src/assets/images/sprite.svg#heartFill"></use>
                                        </svg>
                                    `):f==="EXISTS"&&(t.parentElement.insertAdjacentHTML("afterend",v("Product Already Added To Favorites","danger")),t.innerHTML=`
                                        <svg width="18" height="18" class="d-block flex-shrink-0">
                                            <use href="./src/assets/images/sprite.svg#heartFill"></use>
                                        </svg>
                                    `)}catch(f){console.log(f)}finally{t.disabled=!1}})}e.forEach((t,s)=>{new j(t,{perPage:1,arrows:!1,pagination:!0,drag:!1}).mount();const g=m[s];if(!g||!g.variants)return;const p=t.querySelectorAll(".splide__pagination__page");g.variants.forEach((o,f)=>{const L=p[f];if(!L||!o.colors)return;const oe=o.colors.map(E=>o.colors.length>1?`${E} ${100/o.colors.length}%`:E).join(", ");L.style.cssText=`
                            --variant-base-color: ${o.colors[0]};
                            background-image: linear-gradient( -45deg, ${oe} );
                            box-shadow: 0 0 0 0.125rem ${o.colors[0]};
                        `,L.setAttribute("data-variant-id",`${o.id}`),L.addEventListener("click",()=>{const E=o.id,P=a[s],_=b[s],A=T[s];if(!P||!_)return;const F=new URL(P.href,window.location.origin);F.searchParams.delete("variantId"),F.searchParams.append("variantId",E),P.href=F.toString(),_.setAttribute("data-variant-id",`${E}`),A.setAttribute("data-variant-id",`${E}`);const ie=A.getAttribute("data-product-id");M(ie,E).then(H=>{H?(A.classList.add("bg-primary","text-white"),A.innerHTML=`
                                        <svg width="18" height="18" class="d-block flex-shrink-0">
                                            <use href="./src/assets/images/sprite.svg#heartFill"></use>
                                        </svg>
                                    `):(A.classList.remove("bg-primary","text-white"),A.innerHTML=`
                                        <svg width="18" height="18" class="d-block flex-shrink-0">
                                            <use href="./src/assets/images/sprite.svg#heart"></use>
                                        </svg>
                                    `)}).catch(H=>{console.log(H)})})})})})()})}catch(r){console.log(r),u.insertAdjacentHTML("beforeend",v("Error Loading Products.","danger"))}finally{const r=document.getElementById("productCardSkeleton");r&&r.remove()}};let $=null,B=null;const R=(n,i)=>{n!=null&&n.splide&&n.splide.destroy(!0),i!=null&&i.splide&&i.splide.destroy(!0),B=new j(i,{fixedWidth:100,height:100,gap:12,pagination:!1,arrows:!1,isNavigation:!0}),$=new j(n,{pagination:!1,arrows:!1}),$.sync(B),$.mount(),B.mount()},he=(n,i)=>{var r;const u=document.createElement("ul");return u.classList.add("varients","list-inline","d-flex","align-items-center","gap-3","mt-0"),(r=n.variants)==null||r.forEach(c=>{var m;const l=`
            <li class="mb-0">
                <button class="varient-button d-block rounded-circle transition-3 ${c.id===i?"active":null}" style="--variant-base-color: ${c.colors[0]};background-image: linear-gradient( -135deg, ${(m=c.colors)==null?void 0:m.map(e=>c.colors.length>1?`${e} ${100/c.colors.length}%`:`${e}`).join(", ")} );box-shadow: 0 0 0 0.125rem ${c.colors[0]};" data-varient-id="${c.id}"></button>
            </li>
        `;u.insertAdjacentHTML("beforeend",l)}),u},ye=(n,i,u,r=10)=>{const c=r===0?0:1,l=()=>{let e=parseInt(n.value)||1;(isNaN(e)||e<c)&&(e=c),e>r&&(e=r),n.value=e,m(e)},m=e=>{i.disabled=e>=r,u.disabled=e<=c};n.addEventListener("input",()=>n.value=n.value.replace(/[^0-9]/g,"")),n.addEventListener("blur",l),n.addEventListener("change",()=>{let e=parseInt(n.value)||c;m(e)}),i.addEventListener("click",e=>{e.preventDefault();let a=parseInt(n.value)||c;a<r&&a++,n.value=a,m(a)}),u.addEventListener("click",e=>{e.preventDefault();let a=parseInt(n.value)||c;a>c&&a--,n.value=a,m(a)}),l()},be=`
    <button id="addToFavorite" class="btn bg-primary text-white btn-sm d-flex align-items-center gap-2">
        <svg width="18" height="18" class="d-block">
            <use href="./src/assets/images/sprite.svg#heartFill"></use>
        </svg>
        <span class="d-block">Favorites</span>
    </button>
`,N=(n,i,u,r)=>{n.addEventListener("click",c=>{c.preventDefault(),document.querySelectorAll(".alert").forEach(l=>l.remove()),n.disabled=!0,n.insertAdjacentHTML("beforeend",'<div class="spinner-border spinner-border-sm text-primary" role="status"><span class="visually-hidden">Loading...</span></div>'),se({productId:u,variantId:r}).then(l=>{if(l==="ADDED"){i.innerHTML=be;const m=document.getElementById("addToFavorite");m&&N(m,i,u,r),i.parentElement.insertAdjacentHTML("afterend",v("Product Added To Favorites","success","d-inline-flex"))}else l==="EXISTS"&&i.parentElement.insertAdjacentHTML("afterend",v("Product Already Added To Favorites","danger","d-inline-flex"))}).catch(l=>{console.log(l)}).finally(()=>{n.disabled=!1;const l=n.querySelector(".spinner-border");l&&l.remove()})})},V=document.getElementById("productCategory"),Q=document.querySelector("#productImageWrapper .splide__list"),O=document.querySelector(".product-variant-slider"),X=document.querySelector(".product-variant-thumbnail-slider"),W=document.querySelector(".product-variant-thumbnail-slider .splide__list"),z=document.getElementById("productName"),U=document.getElementById("productShortDescription"),J=document.getElementById("productRating"),G=document.getElementById("variantsContainer"),K=document.getElementById("productDetailedDescription"),Y=document.getElementById("selectedProductName"),x=document.getElementById("selectedProductImg"),w=document.getElementById("selectedProductColor"),S=document.getElementById("selectedProductQuantity"),h=document.querySelector("#quantity #quantityInput"),C=document.querySelector("#quantity #plus"),D=document.querySelector("#quantity #minus"),I=document.getElementById("stock"),q=document.getElementById("totalPrice"),Z=document.getElementById("buyNow"),y=document.getElementById("addToCart"),k=document.querySelector(".favorite-button-container"),Ee=document.getElementById("relatedProducts"),ee=`
    <button id="addToFavorite" class="btn btn-sm bg-transparent text-primary d-flex align-items-center gap-2 border-primary">
        <svg width="18" height="18" class="d-block">
            <use href="./src/assets/images/sprite.svg#heart"></use>
        </svg>
        <span class="d-block">Add to Favorites</span>
    </button>
`,te=`
    <button id="addToFavorite" class="btn bg-primary text-white btn-sm d-flex align-items-center gap-2">
        <svg width="18" height="18" class="d-block">
            <use href="./src/assets/images/sprite.svg#heartFill"></use>
        </svg>
        <span class="d-block">Favorites</span>
    </button>
`,Te=async()=>{var c;const n=new URLSearchParams(window.location.search),i=n.get("id"),u=n.get("variantId");let r=parseInt(h.value)||1;try{const l=me(ne,"collections","products","items",i),m=await ge(l);if(m.exists()){const e=m.data();let a=u;document.title=`Product | ${e.name}`,V&&(V.textContent=e.category),z&&(z.textContent=e.name),U&&(U.textContent=e.shortDescription),J&&(J.textContent=`${e.rating} Ratings`),G&&G.append(he(e,a));const b=document.querySelectorAll(".varient-button"),T=e.variants.find(s=>s.id===a);if(e.variants.length>0&&T.images.length>0){const s=(c=T.images)==null?void 0:c.map(d=>`
                    <li class="splide__slide mb-0">
                        <img src="${d}" alt="${e.name}" class="d-block img-fluid mx-auto" />
                    </li>
                `).join("");Q.innerHTML=s,W.innerHTML=s}M(i,a).then(s=>{s?k.innerHTML=te:k.innerHTML=ee,requestAnimationFrame(()=>{const d=document.getElementById("addToFavorite");d&&N(d,k,i,a)})}),requestAnimationFrame(()=>R(O,X)),b==null||b.forEach(s=>{s.addEventListener("click",()=>{var g;b.forEach(p=>p.classList.remove("active")),s.classList.add("active");const d=s.getAttribute("data-varient-id");a!==d&&(a=d,M(i,a).then(p=>{p?k.innerHTML=te:k.innerHTML=ee,requestAnimationFrame(()=>{const o=document.getElementById("addToFavorite");o&&N(o,k,i,a)})}),(g=e.variants)==null||g.forEach(p=>{var o;if(p.id===d){const f=(o=p.images)==null?void 0:o.map(L=>`<li class="splide__slide mb-0"><img src="${L}" alt="${e.name}" class="d-block img-fluid mx-auto" /></li>`).join("");Q.innerHTML=f,W.innerHTML=f,requestAnimationFrame(()=>R(O,X)),x&&(x.innerHTML=`<img src="${p.images[0]}" alt="${e.name}" class="d-block img-fluid mx-auto" /> `),w&&(w.innerHTML=`<span class="current-variant-color d-block rounded-circle" style="background-color: ${p.colors[0]};"></span>`)}}))})}),K&&K.insertAdjacentHTML("beforeend",`
                <p>${e.detailedDescription}</p>
                <ul class="list-inline">
                    ${Object.keys(e.specifications).map(s=>`
                            <li class="d-flex align-items-center gap-2">
                                <span class="d-block">${s}: </span>
                                <span class="d-block fw-semibold">${e.specifications[s]}</span>
                            </li>
                        `).join("")}
                </ul>
            `),e.variants.forEach(s=>{s.id===a&&(x&&(x.innerHTML=`<img src="${s.images[0]}" alt="${e.name}" class="d-block img-fluid mx-auto" /> `),w&&(w.innerHTML=`<span class="current-variant-color d-block rounded-circle" style="background-color: ${s.colors[0]};"></span>`))}),Y&&(Y.textContent=e.name),S&&(S.textContent=r),ye(h,C,D,e.inStock),e.inStock===0&&(h.value=0,h.disabled=!0,C.disabled=!0,D.disabled=!0,I&&(I.textContent="Out of Stock"));const t=()=>{if(r=parseInt(h.value)||0,r>e.inStock&&(r=e.inStock,h.value=r),e.inStock===0){q&&(q.textContent="₹ 0.00"),I&&(I.textContent="Out of Stock");return}q&&(q.textContent=`₹ ${parseInt(e.price.current)*r}.00`),I&&(I.textContent=e.inStock-r),S&&(S.textContent=r)};t(),h.addEventListener("input",t),h.addEventListener("blur",t),h.addEventListener("change",t),C.addEventListener("click",t),D.addEventListener("click",t),Z&&Z.addEventListener("click",()=>{sessionStorage.setItem("buyNowItem",JSON.stringify({productId:i,productVariant:a,productQuantity:r})),window.location.href="./checkout.html?buyNow=true"}),y&&y.addEventListener("click",s=>{s.preventDefault(),document.querySelectorAll(".alert").forEach(d=>d.remove()),y.disabled=!0,y.insertAdjacentHTML("beforeend",'<div class="spinner-border spinner-border-sm text-light" role="status"><span class="visually-hidden">Loading...</span></div>'),ae(i,a,r).then(d=>{d==="ADDED"?(y.parentElement.insertAdjacentHTML("afterend",v("Product Added To Cart","success")),re()):d==="EXISTS"&&y.parentElement.insertAdjacentHTML("afterend",v("Product Already Exist"))}).catch(d=>{console.log("Failed to add to cart",d)}).finally(()=>{y.disabled=!1;const d=y.querySelector(".spinner-border");d&&d.remove()})}),ve(e.id,e.category,Ee)}else console.log("No such Product Found!")}catch(l){console.log(l)}};Te();
