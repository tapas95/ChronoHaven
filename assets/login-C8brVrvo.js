import{b as f,d as w,e as h,s as u,c as $,a as i,f as B,h as E,G as N,i as k}from"./alert-DMWuZ5g4.js";/* empty css                       */import{t as R}from"./togglePasswordVisibility-DyESKLue.js";const A=async e=>{try{const t=JSON.parse(localStorage.getItem("guestCart"))||[];if(!t.length)return;for(const a of t){const{productId:r,variantId:n,quantity:s}=a,y=`${r}_${n}`,m=f(w,"users",e,"cart",y),g=await h(m);if(g.exists()){const S=(g.data().quantity||0)+s;await u(m,{...g.data(),quantity:S})}else await u(m,{productId:r,variantId:n,quantity:s})}localStorage.removeItem("guestCart")}catch(t){console.error("Failed to sync guest cart to user:",t)}},L=async e=>{const t=JSON.parse(localStorage.getItem("guestFavorites"))||[];if(!(!e||!t.length))try{const a=$(w,"users",e,"favorites");for(const r of t){const n=`${r.productId}_${r.variantId}`,s=f(a,n);(await h(s)).exists()||await u(s,{productId:r.productId,variantId:r.variantId})}localStorage.removeItem("guestFavorites")}catch(a){console.log(a)}},c=document.getElementById("loginForm"),p=document.getElementById("email"),I=document.getElementById("password"),b=document.getElementById("submitLogin"),l=document.getElementById("registerBtn"),d=document.getElementById("forgotPasswordBtn"),T=new URLSearchParams(window.location.search),o=T.get("redirect");if(l){const e=l.getAttribute("href");o?l.setAttribute("href",`${e}?redirect=${o}`):l.setAttribute("href",`${e}`)}if(d){const e=d.getAttribute("href");o?d.setAttribute("href",`${e}?redirect=${o}`):d.setAttribute("href",`${e}`)}R("passwordVisibility","password");c.addEventListener("submit",async e=>{e.preventDefault(),document.querySelectorAll(".alert").forEach(r=>r.remove());const t=p.value.trim(),a=I.value.trim();if(!t)return p.insertAdjacentHTML("afterend",i("Please Enter Email Address"));if(!a)return I.parentElement.insertAdjacentHTML("afterend",i("Please Enter Password"));b.disabled=!0;try{const r=await B(E,t,a);c.innerHTML=i("Signed in successfully. Redirecting now.","success"),await A(r.user.uid),await L(r.user.uid),setTimeout(()=>{o?window.location.href=`./${o}.html?buyNow=true`:window.location.href="./"},1e3)}catch(r){switch(r.code){case"auth/invalid-credential":c.insertAdjacentHTML("afterbegin",i("Invalid Email or Password","danger","mb-3"));break;case"auth/network-request-failed":c.insertAdjacentHTML("afterbegin",i("Network error: Please check your internet connection and try again.","danger","mb-3"));break}}finally{b.disabled=!1}});const v=document.getElementById("loginWithGoogle"),F=new URLSearchParams(window.location.search),P=F.get("redirect"),G=new N;v&&v.addEventListener("click",async()=>{try{const t=(await k(E,G)).user,a=f(w,"users",t.uid);if(!(await h(a)).exists()){const s=(t.displayName||"Guest").split(" ");await u(a,{firstName:s[0],lastName:s[1],email:t.email,phone:t.phoneNumber||null,avatar:t.photoURL,gender:"Other"})}await A(t.uid),await L(t.uid),P?window.location.href=`./${P}.html?buyNow=true`:window.location.href="./"}catch(e){console.error("‚ùå Google login failed:",e.code,e.message),alert("Google login failed: "+e.message)}});
