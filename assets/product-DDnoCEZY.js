import{c as ee,d as Z,q as te,w as ne,g as re,a as oe,h as ae}from"./firebase-config-C_Yz0m2T.js";import{u as se}from"./header-Ck-m_ind.js";import{r as ce,a as ie,b as de,S as M}from"./addToCart-I0CFUIh4.js";import{d as b}from"./alert-DsZaPul3.js";import{a as le,c as D}from"./addToFavorites-BJtZKf8r.js";const ue=async(t,a,d)=>{ce(d,3);try{const n=ee(Z,"collections","products","items"),s=te(n,ne("category","==",a)),c=await re(s);if(c.empty){d.insertAdjacentHTML("beforeend",b("No Products Found.","danger"));return}const l=[];c.forEach(e=>{const o=e.data();o.id!==t&&(l.push(o),d.insertAdjacentHTML("beforeend",ie(o)))}),l.length===0&&d.insertAdjacentHTML("beforeend",b("No related products found.","danger","bi-exclamation-diamond-fill","mx-2")),requestAnimationFrame(()=>{const e=document.querySelectorAll(".variant-images"),o=document.querySelectorAll(".product-title"),g=document.querySelectorAll(".add-to-cart");g.forEach(u=>{u.addEventListener("click",p=>{p.preventDefault(),document.querySelectorAll(".alert").forEach(r=>r.remove()),u.disabled=!0,u.insertAdjacentHTML("beforeend",'<div class="spinner-border spinner-border-sm text-light" role="status"><span class="visually-hidden">Loading...</span></div>');const i=u.getAttribute("data-product-id"),m=u.getAttribute("data-variant-id");i&&m?de(i,m,1).then(r=>{r==="ADDED"?(u.parentElement.insertAdjacentHTML("afterend",b("Product Added To Cart","success","bi-check-circle-fill","fs-xs")),se()):r==="EXISTS"&&u.parentElement.insertAdjacentHTML("afterend",b("Product Already Exist","danger","bi-exclamation-diamond-fill","fs-xs"))}).catch(r=>{console.log("Failed to add to cart",r)}).finally(()=>{u.disabled=!1;const r=u.querySelector(".spinner-border");r&&r.remove()}):console.warn("Product or Variant ID missing")})}),e.forEach((u,p)=>{new M(u,{perPage:1,arrows:!1,pagination:!0,drag:!1}).mount();const m=l[p];if(!m||!m.variants)return;const I=u.querySelectorAll(".splide__pagination__page");m.variants.forEach((r,v)=>{const y=I[v];if(!y||!r.colors)return;const x=r.colors.map(T=>r.colors.length>1?`${T} ${100/r.colors.length}%`:T).join(", ");y.style.cssText=`
                        --variant-base-color: ${r.colors[0]};
                        background-image: linear-gradient( -45deg, ${x} );
                        box-shadow: 0 0 0 0.125rem ${r.colors[0]};
                    `,y.setAttribute("data-variant-id",`${r.id}`),y.addEventListener("click",()=>{const T=r.id,S=o[p],H=g[p];if(!S||!H)return;const P=new URL(S.href,window.location.origin);P.searchParams.delete("variantId"),P.searchParams.append("variantId",T),S.href=P.toString(),H.setAttribute("data-variant-id",`${T}`)})})})})}catch(n){console.log(n),d.insertAdjacentHTML("beforeend",b("Error Loading Products.","danger"))}finally{const n=document.getElementById("productCardSkeleton");n&&n.remove()}};let $=null,w=null;const j=(t,a)=>{t!=null&&t.splide&&t.splide.destroy(!0),a!=null&&a.splide&&a.splide.destroy(!0),w=new M(a,{fixedWidth:100,height:100,gap:12,pagination:!1,arrows:!1,isNavigation:!0}),$=new M(t,{pagination:!1,arrows:!1}),$.sync(w),$.mount(),w.mount()},me=(t,a)=>{var n;const d=document.createElement("ul");return d.classList.add("varients","list-inline","d-flex","align-items-center","gap-3","mt-0"),(n=t.variants)==null||n.forEach(s=>{var l;const c=`
            <li class="mb-0">
                <button class="varient-button d-block rounded-circle transition-3 ${s.id===a?"active":null}" style="--variant-base-color: ${s.colors[0]};background-image: linear-gradient( -135deg, ${(l=s.colors)==null?void 0:l.map(e=>s.colors.length>1?`${e} ${100/s.colors.length}%`:`${e}`).join(", ")} );box-shadow: 0 0 0 0.125rem ${s.colors[0]};" data-varient-id="${s.id}"></button>
            </li>
        `;d.insertAdjacentHTML("beforeend",c)}),d},pe=(t,a,d,n=10)=>{const s=n===0?0:1,c=()=>{let e=parseInt(t.value)||1;(isNaN(e)||e<s)&&(e=s),e>n&&(e=n),t.value=e,l(e)},l=e=>{a.disabled=e>=n,d.disabled=e<=s};t.addEventListener("input",()=>t.value=t.value.replace(/[^0-9]/g,"")),t.addEventListener("blur",c),t.addEventListener("change",()=>{let e=parseInt(t.value)||s;l(e)}),a.addEventListener("click",e=>{e.preventDefault();let o=parseInt(t.value)||s;o<n&&o++,t.value=o,l(o)}),d.addEventListener("click",e=>{e.preventDefault();let o=parseInt(t.value)||s;o>s&&o--,t.value=o,l(o)}),c()},fe=`
    <button id="addToFavorite" class="btn bg-primary text-white btn-sm d-flex align-items-center gap-2">
        <svg width="18" height="18" class="d-block">
            <use href="./src/assets/images/sprite.svg#heartFill"></use>
        </svg>
        <span class="d-block">Favorites</span>
    </button>
`,F=(t,a,d,n)=>{t.addEventListener("click",s=>{s.preventDefault(),document.querySelectorAll(".alert").forEach(c=>c.remove()),t.disabled=!0,t.insertAdjacentHTML("beforeend",'<div class="spinner-border spinner-border-sm text-primary" role="status"><span class="visually-hidden">Loading...</span></div>'),le({productId:d,variantId:n}).then(c=>{if(c==="ADDED"){a.innerHTML=fe;const l=document.getElementById("addToFavorite");l&&F(l,a,d,n),a.parentElement.insertAdjacentHTML("afterend",b("Product Added To Favorites","success","d-inline-flex"))}else c==="EXISTS"&&a.parentElement.insertAdjacentHTML("afterend",b("Product Already Added To Favorites","danger","d-inline-flex"))}).catch(c=>{console.log(c)}).finally(()=>{t.disabled=!1;const c=t.querySelector(".spinner-border");c&&c.remove()})})},N=document.getElementById("productCategory"),_=document.querySelector("#productImageWrapper .splide__list"),R=document.querySelector(".product-variant-slider"),V=document.querySelector(".product-variant-thumbnail-slider"),Q=document.querySelector(".product-variant-thumbnail-slider .splide__list"),O=document.getElementById("productName"),W=document.getElementById("productShortDescription"),z=document.getElementById("productRating"),U=document.getElementById("variantsContainer"),X=document.getElementById("productDetailedDescription"),J=document.getElementById("selectedProductName"),L=document.getElementById("selectedProductImg"),k=document.getElementById("selectedProductColor"),A=document.getElementById("selectedProductQuantity"),f=document.querySelector("#quantity #quantityInput"),B=document.querySelector("#quantity #plus"),C=document.querySelector("#quantity #minus"),h=document.getElementById("stock"),q=document.getElementById("totalPrice"),G=document.getElementById("buyNow"),E=document.querySelector(".favorite-button-container"),ge=document.getElementById("relatedProducts"),K=`
    <button id="addToFavorite" class="btn btn-sm bg-transparent text-primary d-flex align-items-center gap-2 border-primary">
        <svg width="18" height="18" class="d-block">
            <use href="./src/assets/images/sprite.svg#heart"></use>
        </svg>
        <span class="d-block">Add to Favorites</span>
    </button>
`,Y=`
    <button id="addToFavorite" class="btn bg-primary text-white btn-sm d-flex align-items-center gap-2">
        <svg width="18" height="18" class="d-block">
            <use href="./src/assets/images/sprite.svg#heartFill"></use>
        </svg>
        <span class="d-block">Favorites</span>
    </button>
`,ve=async()=>{var s;const t=new URLSearchParams(window.location.search),a=t.get("id"),d=t.get("variantId");let n=parseInt(f.value)||1;try{const c=oe(Z,"collections","products","items",a),l=await ae(c);if(l.exists()){const e=l.data();let o=d;document.title=`Product | ${e.name}`,N&&(N.textContent=e.category),O&&(O.textContent=e.name),W&&(W.textContent=e.shortDescription),z&&(z.textContent=`${e.rating} Ratings`),U&&U.append(me(e,o));const g=document.querySelectorAll(".varient-button"),u=e.variants.find(i=>i.id===o);if(e.variants.length>0&&u.images.length>0){const i=(s=u.images)==null?void 0:s.map(m=>`
                    <li class="splide__slide mb-0">
                        <img src="${m}" alt="${e.name}" class="d-block img-fluid mx-auto" />
                    </li>
                `).join("");_.innerHTML=i,Q.innerHTML=i}D(a,o).then(i=>{i?E.innerHTML=Y:E.innerHTML=K,requestAnimationFrame(()=>{const m=document.getElementById("addToFavorite");m&&F(m,E,a,o)})}),requestAnimationFrame(()=>j(R,V)),g==null||g.forEach(i=>{i.addEventListener("click",()=>{var I;g.forEach(r=>r.classList.remove("active")),i.classList.add("active");const m=i.getAttribute("data-varient-id");o!==m&&(o=m,D(a,o).then(r=>{r?E.innerHTML=Y:E.innerHTML=K,requestAnimationFrame(()=>{const v=document.getElementById("addToFavorite");v&&F(v,E,a,o)})}),(I=e.variants)==null||I.forEach(r=>{var v;if(r.id===m){const y=(v=r.images)==null?void 0:v.map(x=>`<li class="splide__slide mb-0"><img src="${x}" alt="${e.name}" class="d-block img-fluid mx-auto" /></li>`).join("");_.innerHTML=y,Q.innerHTML=y,requestAnimationFrame(()=>j(R,V)),L&&(L.innerHTML=`<img src="${r.images[0]}" alt="${e.name}" class="d-block img-fluid mx-auto" /> `),k&&(k.innerHTML=`<span class="current-variant-color d-block rounded-circle" style="background-color: ${r.colors[0]};"></span>`)}}))})}),X&&X.insertAdjacentHTML("beforeend",`
                <p>${e.detailedDescription}</p>
                <ul class="list-inline">
                    ${Object.keys(e.specifications).map(i=>`
                            <li class="d-flex align-items-center gap-2">
                                <span class="d-block">${i}: </span>
                                <span class="d-block fw-semibold">${e.specifications[i]}</span>
                            </li>
                        `).join("")}
                </ul>
            `),e.variants.forEach(i=>{i.id===o&&(L&&(L.innerHTML=`<img src="${i.images[0]}" alt="${e.name}" class="d-block img-fluid mx-auto" /> `),k&&(k.innerHTML=`<span class="current-variant-color d-block rounded-circle" style="background-color: ${i.colors[0]};"></span>`))}),J&&(J.textContent=e.name),A&&(A.textContent=n),pe(f,B,C,e.inStock),e.inStock===0&&(f.value=0,f.disabled=!0,B.disabled=!0,C.disabled=!0,h&&(h.textContent="Out of Stock"));const p=()=>{if(n=parseInt(f.value)||0,n>e.inStock&&(n=e.inStock,f.value=n),e.inStock===0){q&&(q.textContent="₹ 0.00"),h&&(h.textContent="Out of Stock");return}q&&(q.textContent=`₹ ${parseInt(e.price.current)*n}.00`),h&&(h.textContent=e.inStock-n),A&&(A.textContent=n)};p(),f.addEventListener("input",p),f.addEventListener("blur",p),f.addEventListener("change",p),B.addEventListener("click",p),C.addEventListener("click",p),G&&G.addEventListener("click",()=>{sessionStorage.setItem("buyNowItem",JSON.stringify({productId:a,productVariant:o,productQuantity:n})),window.location.href="./checkout.html?buyNow=true"}),ue(e.id,e.category,ge)}else console.log("No such Product Found!")}catch(c){console.log(c)}};ve();
