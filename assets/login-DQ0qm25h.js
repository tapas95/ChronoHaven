import{b as u,d as m,e as g,s as c,c as S,a as n,f as L,h as I,G as P,i as A}from"./alert-DWjb4CXO.js";/* empty css                       */import{t as N}from"./togglePasswordVisibility-DyESKLue.js";const v=async a=>{try{const e=JSON.parse(localStorage.getItem("guestCart"))||[];if(!e.length)return;for(const s of e){const{productId:t,variantId:r,quantity:o}=s,f=`${t}_${r}`,l=u(m,"users",a,"cart",f),d=await g(l);if(d.exists()){const E=(d.data().quantity||0)+o;await c(l,{...d.data(),quantity:E})}else await c(l,{productId:t,variantId:r,quantity:o})}localStorage.removeItem("guestCart")}catch(e){console.error("Failed to sync guest cart to user:",e)}},b=async a=>{const e=JSON.parse(localStorage.getItem("guestFavorites"))||[];if(!(!a||!e.length))try{const s=S(m,"users",a,"favorites");for(const t of e){const r=`${t.productId}_${t.variantId}`,o=u(s,r);(await g(o)).exists()||await c(o,{productId:t.productId,variantId:t.variantId})}localStorage.removeItem("guestFavorites")}catch(s){console.log(s)}},i=document.getElementById("loginForm"),w=document.getElementById("email"),y=document.getElementById("password"),p=document.getElementById("submitLogin");N("passwordVisibility","password");i.addEventListener("submit",async a=>{a.preventDefault(),document.querySelectorAll(".alert").forEach(t=>t.remove());const e=w.value.trim(),s=y.value.trim();if(!e)return w.insertAdjacentHTML("afterend",n("Please Enter Email Address"));if(!s)return y.parentElement.insertAdjacentHTML("afterend",n("Please Enter Password"));p.disabled=!0;try{const t=await L(I,e,s);i.innerHTML=n("Signed in successfully. Redirecting now.","success"),await v(t.user.uid),await b(t.user.uid),setTimeout(()=>{window.location.href="./"},1e3)}catch(t){switch(t.code){case"auth/invalid-credential":i.insertAdjacentHTML("afterbegin",n("Invalid Email or Password","danger","mb-3"));break;case"auth/network-request-failed":i.insertAdjacentHTML("afterbegin",n("Network error: Please check your internet connection and try again.","danger","mb-3"));break}}finally{p.disabled=!1}});const h=document.getElementById("loginWithGoogle"),T=new P;h&&h.addEventListener("click",async()=>{try{const e=(await A(I,T)).user,s=u(m,"users",e.uid);if(!(await g(s)).exists()){const o=(e.displayName||"Guest").split(" ");await c(s,{firstName:o[0],lastName:o[1],email:e.email,phone:e.phoneNumber||null,avatar:e.photoURL,gender:"Other"})}await v(e.uid),await b(e.uid),window.location.href="./"}catch(a){console.error("‚ùå Google login failed:",a.code,a.message),alert("Google login failed: "+a.message)}});
