import{c as re,d as ee,q as oe,w as ae,g as se,a as ie,h as de}from"./firebase-config-C_Yz0m2T.js";import{u as te}from"./header-Ck-m_ind.js";import{r as ce,a as le,S as H}from"./productCardSkeleton-DCXahn5e.js";import{a as ne}from"./addToCart-DR5xnXYZ.js";import{d as g}from"./alert-DsZaPul3.js";import{a as ue,c as j}from"./addToFavorites-BJtZKf8r.js";const me=async(t,a,l)=>{ce(l,3);try{const n=re(ee,"collections","products","items"),d=oe(n,ae("category","==",a)),c=await se(d);if(c.empty){l.insertAdjacentHTML("beforeend",g("No Products Found.","danger"));return}const u=[];c.forEach(e=>{const r=e.data();r.id!==t&&(u.push(r),l.insertAdjacentHTML("beforeend",le(r)))}),u.length===0&&l.insertAdjacentHTML("beforeend",g("No related products found.","danger","bi-exclamation-diamond-fill","mx-2")),requestAnimationFrame(()=>{const e=document.querySelectorAll(".variant-images"),r=document.querySelectorAll(".product-title"),y=document.querySelectorAll(".add-to-cart");y.forEach(m=>{m.addEventListener("click",p=>{p.preventDefault(),document.querySelectorAll(".alert").forEach(o=>o.remove()),m.disabled=!0,m.insertAdjacentHTML("beforeend",'<div class="spinner-border spinner-border-sm text-light" role="status"><span class="visually-hidden">Loading...</span></div>');const i=m.getAttribute("data-product-id"),s=m.getAttribute("data-variant-id");i&&s?ne(i,s,1).then(o=>{o==="ADDED"?(m.parentElement.insertAdjacentHTML("afterend",g("Product Added To Cart","success","bi-check-circle-fill","fs-xs")),te()):o==="EXISTS"&&m.parentElement.insertAdjacentHTML("afterend",g("Product Already Exist","danger","bi-exclamation-diamond-fill","fs-xs"))}).catch(o=>{console.log("Failed to add to cart",o)}).finally(()=>{m.disabled=!1;const o=m.querySelector(".spinner-border");o&&o.remove()}):console.warn("Product or Variant ID missing")})}),e.forEach((m,p)=>{new H(m,{perPage:1,arrows:!1,pagination:!0,drag:!1}).mount();const s=u[p];if(!s||!s.variants)return;const L=m.querySelectorAll(".splide__pagination__page");s.variants.forEach((o,b)=>{const h=L[b];if(!h||!o.colors)return;const x=o.colors.map(I=>o.colors.length>1?`${I} ${100/o.colors.length}%`:I).join(", ");h.style.cssText=`
                        --variant-base-color: ${o.colors[0]};
                        background-image: linear-gradient( -45deg, ${x} );
                        box-shadow: 0 0 0 0.125rem ${o.colors[0]};
                    `,h.setAttribute("data-variant-id",`${o.id}`),h.addEventListener("click",()=>{const I=o.id,P=r[p],D=y[p];if(!P||!D)return;const $=new URL(P.href,window.location.origin);$.searchParams.delete("variantId"),$.searchParams.append("variantId",I),P.href=$.toString(),D.setAttribute("data-variant-id",`${I}`)})})})})}catch(n){console.log(n),l.insertAdjacentHTML("beforeend",g("Error Loading Products.","danger"))}finally{const n=document.getElementById("productCardSkeleton");n&&n.remove()}};let w=null,C=null;const N=(t,a)=>{t!=null&&t.splide&&t.splide.destroy(!0),a!=null&&a.splide&&a.splide.destroy(!0),C=new H(a,{fixedWidth:100,height:100,gap:12,pagination:!1,arrows:!1,isNavigation:!0}),w=new H(t,{pagination:!1,arrows:!1}),w.sync(C),w.mount(),C.mount()},pe=(t,a)=>{var n;const l=document.createElement("ul");return l.classList.add("varients","list-inline","d-flex","align-items-center","gap-3","mt-0"),(n=t.variants)==null||n.forEach(d=>{var u;const c=`
            <li class="mb-0">
                <button class="varient-button d-block rounded-circle transition-3 ${d.id===a?"active":null}" style="--variant-base-color: ${d.colors[0]};background-image: linear-gradient( -135deg, ${(u=d.colors)==null?void 0:u.map(e=>d.colors.length>1?`${e} ${100/d.colors.length}%`:`${e}`).join(", ")} );box-shadow: 0 0 0 0.125rem ${d.colors[0]};" data-varient-id="${d.id}"></button>
            </li>
        `;l.insertAdjacentHTML("beforeend",c)}),l},fe=(t,a,l,n=10)=>{const d=n===0?0:1,c=()=>{let e=parseInt(t.value)||1;(isNaN(e)||e<d)&&(e=d),e>n&&(e=n),t.value=e,u(e)},u=e=>{a.disabled=e>=n,l.disabled=e<=d};t.addEventListener("input",()=>t.value=t.value.replace(/[^0-9]/g,"")),t.addEventListener("blur",c),t.addEventListener("change",()=>{let e=parseInt(t.value)||d;u(e)}),a.addEventListener("click",e=>{e.preventDefault();let r=parseInt(t.value)||d;r<n&&r++,t.value=r,u(r)}),l.addEventListener("click",e=>{e.preventDefault();let r=parseInt(t.value)||d;r>d&&r--,t.value=r,u(r)}),c()},ge=`
    <button id="addToFavorite" class="btn bg-primary text-white btn-sm d-flex align-items-center gap-2">
        <svg width="18" height="18" class="d-block">
            <use href="./src/assets/images/sprite.svg#heartFill"></use>
        </svg>
        <span class="d-block">Favorites</span>
    </button>
`,F=(t,a,l,n)=>{t.addEventListener("click",d=>{d.preventDefault(),document.querySelectorAll(".alert").forEach(c=>c.remove()),t.disabled=!0,t.insertAdjacentHTML("beforeend",'<div class="spinner-border spinner-border-sm text-primary" role="status"><span class="visually-hidden">Loading...</span></div>'),ue({productId:l,variantId:n}).then(c=>{if(c==="ADDED"){a.innerHTML=ge;const u=document.getElementById("addToFavorite");u&&F(u,a,l,n),a.parentElement.insertAdjacentHTML("afterend",g("Product Added To Favorites","success","d-inline-flex"))}else c==="EXISTS"&&a.parentElement.insertAdjacentHTML("afterend",g("Product Already Added To Favorites","danger","d-inline-flex"))}).catch(c=>{console.log(c)}).finally(()=>{t.disabled=!1;const c=t.querySelector(".spinner-border");c&&c.remove()})})},_=document.getElementById("productCategory"),R=document.querySelector("#productImageWrapper .splide__list"),V=document.querySelector(".product-variant-slider"),Q=document.querySelector(".product-variant-thumbnail-slider"),O=document.querySelector(".product-variant-thumbnail-slider .splide__list"),W=document.getElementById("productName"),X=document.getElementById("productShortDescription"),z=document.getElementById("productRating"),U=document.getElementById("variantsContainer"),J=document.getElementById("productDetailedDescription"),G=document.getElementById("selectedProductName"),A=document.getElementById("selectedProductImg"),k=document.getElementById("selectedProductColor"),S=document.getElementById("selectedProductQuantity"),f=document.querySelector("#quantity #quantityInput"),B=document.querySelector("#quantity #plus"),M=document.querySelector("#quantity #minus"),E=document.getElementById("stock"),q=document.getElementById("totalPrice"),K=document.getElementById("buyNow"),v=document.getElementById("addToCart"),T=document.querySelector(".favorite-button-container"),ve=document.getElementById("relatedProducts"),Y=`
    <button id="addToFavorite" class="btn btn-sm bg-transparent text-primary d-flex align-items-center gap-2 border-primary">
        <svg width="18" height="18" class="d-block">
            <use href="./src/assets/images/sprite.svg#heart"></use>
        </svg>
        <span class="d-block">Add to Favorites</span>
    </button>
`,Z=`
    <button id="addToFavorite" class="btn bg-primary text-white btn-sm d-flex align-items-center gap-2">
        <svg width="18" height="18" class="d-block">
            <use href="./src/assets/images/sprite.svg#heartFill"></use>
        </svg>
        <span class="d-block">Favorites</span>
    </button>
`,ye=async()=>{var d;const t=new URLSearchParams(window.location.search),a=t.get("id"),l=t.get("variantId");let n=parseInt(f.value)||1;try{const c=ie(ee,"collections","products","items",a),u=await de(c);if(u.exists()){const e=u.data();let r=l;document.title=`Product | ${e.name}`,_&&(_.textContent=e.category),W&&(W.textContent=e.name),X&&(X.textContent=e.shortDescription),z&&(z.textContent=`${e.rating} Ratings`),U&&U.append(pe(e,r));const y=document.querySelectorAll(".varient-button"),m=e.variants.find(i=>i.id===r);if(e.variants.length>0&&m.images.length>0){const i=(d=m.images)==null?void 0:d.map(s=>`
                    <li class="splide__slide mb-0">
                        <img src="${s}" alt="${e.name}" class="d-block img-fluid mx-auto" />
                    </li>
                `).join("");R.innerHTML=i,O.innerHTML=i}j(a,r).then(i=>{i?T.innerHTML=Z:T.innerHTML=Y,requestAnimationFrame(()=>{const s=document.getElementById("addToFavorite");s&&F(s,T,a,r)})}),requestAnimationFrame(()=>N(V,Q)),y==null||y.forEach(i=>{i.addEventListener("click",()=>{var L;y.forEach(o=>o.classList.remove("active")),i.classList.add("active");const s=i.getAttribute("data-varient-id");r!==s&&(r=s,j(a,r).then(o=>{o?T.innerHTML=Z:T.innerHTML=Y,requestAnimationFrame(()=>{const b=document.getElementById("addToFavorite");b&&F(b,T,a,r)})}),(L=e.variants)==null||L.forEach(o=>{var b;if(o.id===s){const h=(b=o.images)==null?void 0:b.map(x=>`<li class="splide__slide mb-0"><img src="${x}" alt="${e.name}" class="d-block img-fluid mx-auto" /></li>`).join("");R.innerHTML=h,O.innerHTML=h,requestAnimationFrame(()=>N(V,Q)),A&&(A.innerHTML=`<img src="${o.images[0]}" alt="${e.name}" class="d-block img-fluid mx-auto" /> `),k&&(k.innerHTML=`<span class="current-variant-color d-block rounded-circle" style="background-color: ${o.colors[0]};"></span>`)}}))})}),J&&J.insertAdjacentHTML("beforeend",`
                <p>${e.detailedDescription}</p>
                <ul class="list-inline">
                    ${Object.keys(e.specifications).map(i=>`
                            <li class="d-flex align-items-center gap-2">
                                <span class="d-block">${i}: </span>
                                <span class="d-block fw-semibold">${e.specifications[i]}</span>
                            </li>
                        `).join("")}
                </ul>
            `),e.variants.forEach(i=>{i.id===r&&(A&&(A.innerHTML=`<img src="${i.images[0]}" alt="${e.name}" class="d-block img-fluid mx-auto" /> `),k&&(k.innerHTML=`<span class="current-variant-color d-block rounded-circle" style="background-color: ${i.colors[0]};"></span>`))}),G&&(G.textContent=e.name),S&&(S.textContent=n),fe(f,B,M,e.inStock),e.inStock===0&&(f.value=0,f.disabled=!0,B.disabled=!0,M.disabled=!0,E&&(E.textContent="Out of Stock"));const p=()=>{if(n=parseInt(f.value)||0,n>e.inStock&&(n=e.inStock,f.value=n),e.inStock===0){q&&(q.textContent="₹ 0.00"),E&&(E.textContent="Out of Stock");return}q&&(q.textContent=`₹ ${parseInt(e.price.current)*n}.00`),E&&(E.textContent=e.inStock-n),S&&(S.textContent=n)};p(),f.addEventListener("input",p),f.addEventListener("blur",p),f.addEventListener("change",p),B.addEventListener("click",p),M.addEventListener("click",p),K&&K.addEventListener("click",()=>{sessionStorage.setItem("buyNowItem",JSON.stringify({productId:a,productVariant:r,productQuantity:n})),window.location.href="./checkout.html?buyNow=true"}),v&&v.addEventListener("click",i=>{i.preventDefault(),document.querySelectorAll(".alert").forEach(s=>s.remove()),v.disabled=!0,v.insertAdjacentHTML("beforeend",'<div class="spinner-border spinner-border-sm text-light" role="status"><span class="visually-hidden">Loading...</span></div>'),ne(a,r,n).then(s=>{s==="ADDED"?(v.parentElement.insertAdjacentHTML("afterend",g("Product Added To Cart","success")),te()):s==="EXISTS"&&v.parentElement.insertAdjacentHTML("afterend",g("Product Already Exist"))}).catch(s=>{console.log("Failed to add to cart",s)}).finally(()=>{v.disabled=!1;const s=v.querySelector(".spinner-border");s&&s.remove()})}),me(e.id,e.category,ve)}else console.log("No such Product Found!")}catch(c){console.log(c)}};ye();
