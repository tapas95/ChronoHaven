import{b as y,d as f,e as O,g as $,q as j,c as E,w,u as L,a as c,n as P}from"./alert-DMWuZ5g4.js";import{g as z}from"./header-_iNkTwr9.js";import"./sidebar-BEAag9fV.js";import{C as R,S as q}from"./state-AGKt8l62.js";import{C}from"./city-BZRNjcdY.js";const i=document.getElementById("addressForm"),m=document.getElementById("address"),l=document.getElementById("country"),a=document.getElementById("state"),t=document.getElementById("city"),p=document.getElementById("zip"),o=document.getElementById("saveAddress"),A=document.getElementById("description"),g=document.querySelectorAll('input[name="saveAddressAs"]'),U=new URLSearchParams(window.location.search),h=U.get("addressId");let H=null;const k=[m,l,a,t,p,A],I=R.getCountryByCode("IN");let D="",B="";a&&(a.disabled=!0);t&&(t.disabled=!0);l&&(l.insertAdjacentHTML("beforeend",`<option value="${I.isoCode}">${I.name}</option>`),l.addEventListener("change",s=>{D=s.target.value,q.getStatesOfCountry(s.target.value).forEach(d=>{a&&(a.insertAdjacentHTML("beforeend",`<option value="${d.isoCode}">${d.name}</option>`),a.disabled=!1)})}));a&&a.addEventListener("change",s=>{B=s.target.value;const n=C.getCitiesOfState(D,B);t&&(t.innerHTML='<option value="" selected disabled>Select City</option>'),n.forEach(d=>{t&&(t.insertAdjacentHTML("beforeend",`<option value="${d.name}">${d.name}</option>`),t.disabled=!1)})});const M=()=>{let s="";return document.querySelectorAll(".alert").forEach(n=>n.remove()),m&&!m.value.trim()?m.insertAdjacentHTML("afterend",c("Please Enter Your Address")):l&&!l.value.trim()?l.insertAdjacentHTML("afterend",c("Country is required")):a&&!a.value.trim()?a.insertAdjacentHTML("afterend",c("State is required")):t&&!t.value.trim()?t.insertAdjacentHTML("afterend",c("City is required")):p&&!p.value.trim()?p.insertAdjacentHTML("afterend",c("ZIP Code is required")):(g&&g.forEach(n=>{n.checked&&(s=n.value)}),{address:m.value.trim(),country:l.value.trim(),state:a.value.trim(),city:t.value.trim(),zip:p.value.trim(),description:A.value.trim(),default:s})},S=()=>{const s=M(),n=Object.keys(s).some(d=>s[d]!==H[d]);o&&(o.disabled=!n)},x=async()=>{const s=await z();if(s)if(h){o&&(o.disabled=!0);const n=y(f,"users",s.uid,"addresses",h),d=await O(n);if(d.exists()){const e=d.data();H=e,m&&(m.value=e.address||""),l&&(l.value=e.country||""),q.getStatesOfCountry(e.country).forEach(r=>{a&&a.insertAdjacentHTML("beforeend",`<option value="${r.isoCode}">${r.name}</option>`)}),a&&(a.disabled=!1,a.value=e.state||"",a.addEventListener("change",r=>{const b=r.target.value,F=C.getCitiesOfState(e.country,b);t&&(t.innerHTML='<option value="" selected disabled>Select City</option>'),F.forEach(T=>{t&&t.insertAdjacentHTML("beforeend",`<option value="${T.name}">${T.name}</option>`)})}));const v=C.getCitiesOfState(e.country,e.state);t&&(t.innerHTML='<option value="" selected disabled>Select City</option>'),v.forEach(r=>{t&&t.insertAdjacentHTML("beforeend",`<option value="${r.name}">${r.name}</option>`)}),t&&(t.disabled=!1,t.value=e.city||""),p&&(p.value=e.zip||""),A&&(A.value=e.description||""),g&&e.default&&g.forEach(r=>r.checked=r.value===e.default)}k.forEach(e=>{e&&e.addEventListener("input",S)}),g.forEach(e=>{e.addEventListener("change",S)}),i&&i.addEventListener("submit",async e=>{e.preventDefault();const u=M();if(u)try{o&&(o.disabled=!0);const v=y(f,"users",s.uid,"addresses",h);if(u.default==="Shipping"||u.default==="Billing"){const r=await $(j(E(f,`users/${s.uid}/addresses`),w("default","==",u.default)));for(const b of r.docs)await L(y(f,`users/${s.uid}/addresses/${b.id}`),{default:""})}await L(v,u),H=u,S(),i.insertAdjacentHTML("afterbegin",c("Address Updated Successfully!","success","mt-0 mb-4"))}catch(v){console.log(v),i.insertAdjacentHTML("afterbegin",c("Failed to update address"))}})}else i&&i.addEventListener("submit",async n=>{n.preventDefault();const d=M();if(d)try{if(o&&(o.disabled=!0),d.default==="Shipping"||d.default==="Billing"){const e=await $(j(E(f,`users/${s.uid}/addresses`),w("default","==",d.default)));for(const u of e.docs)await L(y(f,`users/${s.uid}/addresses/${u.id}`),{default:""})}await P(E(f,"users",s.uid,"addresses"),d),i.insertAdjacentHTML("afterbegin",c("Address Added Successfully!","success","mt-0 mb-4")),i.reset()}catch(e){console.log(e),i.insertAdjacentHTML("afterbegin",c("Failed to add address"))}finally{o&&(o.disabled=!1)}});else i&&(i.innerHTML="",i.insertAdjacentHTML("afterbegin",c("Please login to Add Address","danger","mt-0 mb-4")))};x();
