import{n as te,c as Q,d as S,o as ne,b as N,e as O,u as R,p as Z,a as i,g as ie,m as re}from"./alert-BfWc_co2.js";import{g as ae}from"./header-DJ3fnkyg.js";import{C as se,S as W}from"./state-AGKt8l62.js";import{C as X}from"./city-BZRNjcdY.js";const z=async(e,a)=>{try{return(await te(Q(S,"orders"),{userId:e,...a,createdAt:ne()})).id}catch(t){throw console.error("Error placing order: ",t),t}},U=document.getElementById("personalInfo"),H=document.getElementById("askForLogin"),C=document.getElementById("firstName"),A=document.getElementById("lastName"),p=document.getElementById("email"),g=document.getElementById("phone"),B=document.getElementById("shippingAddress"),l=document.getElementById("shippingState"),o=document.getElementById("shippingCity"),b=document.getElementById("shippingCountry"),j=document.getElementById("shippingZip"),J=document.getElementById("shippingDescription"),x=document.getElementById("billingInfo"),w=document.getElementById("billingAddress"),c=document.getElementById("billingState"),d=document.getElementById("billingCity"),h=document.getElementById("billingCountry"),q=document.getElementById("billingZip"),V=document.getElementById("billingDescription"),P=document.getElementById("addDifferentAddress"),E=document.getElementById("subTotal"),T=document.getElementById("total"),r=document.getElementById("placeOrder"),$=se.getCountryByCode("IN");let D=!1,_="",Y="",ee="",G="";l&&(l.disabled=!0);o&&(o.disabled=!0);c&&(c.disabled=!0);d&&(d.disabled=!0);b&&(b.insertAdjacentHTML("beforeend",`<option value="${$.isoCode}">${$.name}</option>`),b.addEventListener("change",e=>{_=e.target.value,W.getStatesOfCountry(e.target.value).forEach(t=>{l&&(l.insertAdjacentHTML("beforeend",`<option value="${t.isoCode}">${t.name}</option>`),l.disabled=!1)})}));l&&l.addEventListener("change",e=>{Y=e.target.value;const a=X.getCitiesOfState(_,Y);o&&(o.innerHTML='<option value="" selected disabled>Select City</option>'),a.forEach(t=>{o&&(o.insertAdjacentHTML("beforeend",`<option value="${t.name}">${t.name}</option>`),o.disabled=!1)})});h&&(h.insertAdjacentHTML("beforeend",`<option value="${$.isoCode}">${$.name}</option>`),h.addEventListener("change",e=>{ee=e.target.value,W.getStatesOfCountry(e.target.value).forEach(t=>{c&&(c.insertAdjacentHTML("beforeend",`<option value="${t.isoCode}">${t.name}</option>`),c.disabled=!1)})}));c&&c.addEventListener("change",e=>{G=e.target.value;const a=X.getCitiesOfState(ee,G);d&&(d.innerHTML='<option value="" selected disabled>Select City</option>'),a.forEach(t=>{d&&(d.insertAdjacentHTML("beforeend",`<option value="${t.name}">${t.name}</option>`),d.disabled=!1)})});x&&(x.style.display="none");P&&P.addEventListener("click",e=>{e.preventDefault(),P.classList.add("d-none"),D=!0,x&&(x.style.display="block")});function K(){const e=/^[^\s@]+@[^\s@]+\.[^\s@]+$/,a=/^[0-9]{10}$/;if(document.querySelectorAll(".alert").forEach(t=>t.remove()),C&&!C.value.trim())return C.insertAdjacentHTML("afterend",i("Please enter your First Name"));if(A&&!A.value.trim())return A.insertAdjacentHTML("afterend",i("Please enter your Last Name"));if(p&&!p.value.trim())return p.insertAdjacentHTML("afterend",i("Please enter your Email"));if(p&&!e.test(p.value.trim()))return p.insertAdjacentHTML("afterend",i("Invalid Email Address"));if(g&&!g.value.trim())return g.insertAdjacentHTML("afterend",i("Please enter your Mobile Number"));if(g&&!a.test(g.value.trim()))return g.insertAdjacentHTML("afterend",i("Phone number must be 10 digits"));if(B&&!B.value.trim())return B.insertAdjacentHTML("afterend",i("Shipping Address is required"));if(b&&!b.value.trim())return b.insertAdjacentHTML("afterend",i("Country is required"));if(l&&!l.value.trim())return l.insertAdjacentHTML("afterend",i("State is required"));if(o&&!o.value.trim())return o.insertAdjacentHTML("afterend",i("City is required"));if(j&&!j.value.trim())return j.insertAdjacentHTML("afterend",i("ZIP Code is required"));if(D){if(w&&!w.value.trim())return w.insertAdjacentHTML("afterend",i("Billing Address is required"));if(h&&!h.value.trim())return h.insertAdjacentHTML("afterend",i("Country is required"));if(c&&!c.value.trim())return c.insertAdjacentHTML("afterend",i("State is required"));if(d&&!d.value.trim())return d.insertAdjacentHTML("afterend",i("City is required"));if(q&&!q.value.trim())return q.insertAdjacentHTML("afterend",i("ZIP Code is required"))}return!0}const oe=async()=>{var a,t;const e=await ae();if(e){H&&H.remove();try{const n=N(S,"users",e.uid),u=await O(n);if(u.exists()){const v=u.data();C&&(C.value=v.firstName||""),A&&(A.value=v.lastName||""),p&&(p.value=v.email||""),g&&(g.value=v.phone||"")}}catch(n){console.log(n)}if(new URLSearchParams(window.location.search).get("buyNow")==="true"){const n=JSON.parse(sessionStorage.getItem("buyNowItem"));if(!n)return;try{const u=N(S,"collections","products","items",n.id),v=await O(u);if(v.exists()){const y=v.data();E&&(E.textContent=`₹ ${(y.price.current*n.quantity).toFixed(2)}`),T&&(T.textContent=`₹ ${(y.price.current*n.quantity).toFixed(2)}`),r&&r.addEventListener("click",async M=>{var L,f;if(M.preventDefault(),!K())return;const I={firstName:C.value.trim(),lastName:A.value.trim(),email:p.value.trim(),phone:g.value.trim(),shipping:{address:B.value.trim(),country:b.value.trim(),state:l.value.trim(),city:o.value.trim(),zip:j.value.trim(),description:J.value.trim()},billing:D?{address:w.value.trim(),country:h.value.trim(),state:c.value.trim(),city:d.value.trim(),zip:q.value.trim(),description:V.value.trim()}:null,subTotal:E.textContent,total:T.textContent,products:[{id:n.id,variantId:n.variantId,name:y.name,productImage:(L=y.variants)==null?void 0:L.find(m=>m.id===n.variantId).images[0],quantity:n.quantity,sku:y.sku,variant:(f=y.variants)==null?void 0:f.find(m=>m.id===n.variantId).colors,price:y.price.current}],paymentMethod:"COD",orderStatus:"pending"};r.disabled=!0,r.insertAdjacentHTML("afterbegin",'<div class="spinner-border spinner-border-sm text-light" role="status"><span class="visually-hidden">Loading...</span></div>');const s=await z(e.uid,I);await R(u,{inStock:Z(-n.quantity)}),sessionStorage.removeItem("buyNowItem"),r.insertAdjacentHTML("afterend",i("Order Placed","success")),setTimeout(()=>{window.location.href=`./thank-you.html?orderId=${s}`},1e3)})}}catch(u){console.log(u)}}else try{let n=[],u=0,v=0;const y=Q(S,"users",e.uid,"cart"),M=await ie(y);if(M.empty)U&&U.insertAdjacentHTML("beforebegin",i("No Item Found in Your Cart","danger","mt-0 mb-3")),r&&(r.disabled=!0),document.querySelectorAll("input, select, textarea").forEach(I=>I.disabled=!0);else{for(const I of M.docs){const s=I.data(),L=N(S,"collections","products","items",s.productId),f=await O(L);if(f.exists()){const m=f.data();u+=m.price.current*s.quantity,v+=m.price.current*s.quantity,n.push({id:s.productId,variantId:s.variantId||null,name:m.name,productImage:(a=m.variants)==null?void 0:a.find(k=>k.id===s.variantId).images[0],quantity:s.quantity,sku:m.sku,variant:(t=m.variants)==null?void 0:t.find(k=>k.id===s.variantId).colors,price:m.price.current})}}E&&(E.textContent=`₹ ${u.toFixed(2)}`),T&&(T.textContent=`₹ ${u.toFixed(2)}`),r&&r.addEventListener("click",async I=>{if(I.preventDefault(),!K())return;const s={firstName:C.value.trim(),lastName:A.value.trim(),email:p.value.trim(),phone:g.value.trim(),shipping:{address:B.value.trim(),country:b.value.trim(),state:l.value.trim(),city:o.value.trim(),zip:j.value.trim(),description:J.value.trim()},billing:D?{address:w.value.trim(),country:h.value.trim(),state:c.value.trim(),city:d.value.trim(),zip:q.value.trim(),description:V.value.trim()}:null,subTotal:E.textContent,total:T.textContent,products:n,paymentMethod:"COD",orderStatus:"pending"};r.disabled=!0,r.insertAdjacentHTML("afterbegin",'<div class="spinner-border spinner-border-sm text-light" role="status"><span class="visually-hidden">Loading...</span></div>');const L=await z(e.uid,s);for(const f of n)await R(N(S,"collections","products","items",f.id),{inStock:Z(-f.quantity)});for(const f of M.docs)await re(f.ref);r.insertAdjacentHTML("afterend",i("Order Placed","success")),setTimeout(()=>{window.location.href=`./thank-you.html?orderId=${L}`},1e3)})}}catch(n){console.log(n)}}else H&&document.body.contains(H)&&H.insertAdjacentHTML("afterend",i("Please login to Place Order.","danger","mb-3")),r&&(r.disabled=!0),document.querySelectorAll("input, select, textarea").forEach(F=>F.disabled=!0)};oe();
