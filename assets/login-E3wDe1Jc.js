import{c as I,d as u,g as E,a as d,u as S,i as L,s as m,b as h,e as P,f as y,G as A,h as N}from"./firebase-config-z-tLKvAO.js";/* empty css                       */import{d as c}from"./alert-DsZaPul3.js";import{t as C}from"./togglePasswordVisibility-DyESKLue.js";const v=async r=>{try{const e=JSON.parse(localStorage.getItem("guestCart"))||[];if(!e.length)return;const s=I(u,"users",r,"cart"),a=await E(s),o=[];a.forEach(t=>{const i=t.data();o.push({id:t.id,...i})});for(const t of e){const i=o.find(n=>n.productId===t.productId&&(n.variantId||null)===(t.variantId||null));if(i){const n=d(s,i.id);await S(n,{quantity:L(t.quantity)})}else{const n=d(s);await m(n,{productId:t.productId,quantity:t.quantity,variantId:t.variantId||null})}}localStorage.removeItem("guestCart")}catch(e){console.error("Failed to sync guest cart to user:",e)}},b=async r=>{const e=JSON.parse(localStorage.getItem("guestFavorites"))||[];if(!(!r||!e.length))try{const s=I(u,"users",r,"favorites");for(const a of e){const o=`${a.productId}_${a.variantId}`,t=d(s,o);(await h(t)).exists()||await m(t,{productId:a.productId,variantId:a.variantId})}localStorage.removeItem("guestFavorites")}catch(s){console.log(s)}},l=document.getElementById("loginForm"),g=document.getElementById("email"),f=document.getElementById("password"),p=document.getElementById("submitLogin");C("passwordVisibility","password");l.addEventListener("submit",async r=>{r.preventDefault(),document.querySelectorAll(".alert").forEach(a=>a.remove());const e=g.value.trim(),s=f.value.trim();if(!e)return g.insertAdjacentHTML("afterend",c("Please Enter Email Address"));if(!s)return f.parentElement.insertAdjacentHTML("afterend",c("Please Enter Password"));p.disabled=!0;try{const a=await P(y,e,s);l.innerHTML=c("Signed in successfully. Redirecting now.","success"),await v(a.user.uid),await b(a.user.uid),setTimeout(()=>{window.location.href="./"},1e3)}catch(a){switch(a.code){case"auth/invalid-credential":l.insertAdjacentHTML("afterbegin",c("Invalid Email or Password","danger","mb-3"));break;case"auth/network-request-failed":l.insertAdjacentHTML("afterbegin",c("Network error: Please check your internet connection and try again.","danger","mb-3"));break}}finally{p.disabled=!1}});const w=document.getElementById("loginWithGoogle"),R=new A;w&&w.addEventListener("click",async()=>{try{const e=(await N(y,R)).user,s=d(u,"users",e.uid);if(!(await h(s)).exists()){const t=(e.displayName||"Guest").split(" ");await m(s,{firstName:t[0],lastName:t[1],email:e.email,phone:e.phoneNumber||null,avatar:e.photoURL,gender:"Other"})}await v(e.uid),await b(e.uid),window.location.href="./"}catch(r){console.error("‚ùå Google login failed:",r.code,r.message),alert("Google login failed: "+r.message)}});
