import{d as j,a as P,g as M,u as N,b as e,c as S,l as T,m as x,E as I,r as k,t as D}from"./alert-CSPBdpzb.js";import{g as C,h as $}from"./header-BX1Lkcnd.js";import"./sidebar-LtTCqdgh.js";import{C as q,S as F}from"./state-AGKt8l62.js";import{t as A}from"./togglePasswordVisibility-DyESKLue.js";const f=document.getElementById("firstName"),p=document.getElementById("lastName"),i=document.getElementById("email"),o=document.getElementById("phone"),E=document.querySelectorAll('input[name="gender"]'),g=document.getElementById("dob"),v=document.getElementById("saveProfile"),y=document.getElementById("addressList"),c=document.getElementById("updatePasswordForm"),b=document.getElementById("oldPassword"),u=document.getElementById("newPassword"),m=document.getElementById("confirmNewPassword"),h=document.getElementById("updatePasswordBtn");A("oldPasswordVisibility","oldPassword");A("newPasswordVisibility","newPassword");A("confirmNewPasswordVisibility","confirmNewPassword");function V(){const a=/^[^\s@]+@[^\s@]+\.[^\s@]+$/,l=/^[0-9]{10}$/,w=[...E].find(d=>d.checked);return document.querySelectorAll(".alert").forEach(d=>d.remove()),f&&!f.value.trim()?f.insertAdjacentHTML("afterend",e("Please enter your First Name")):p&&!p.value.trim()?p.insertAdjacentHTML("afterend",e("Please enter your Last Name")):i&&!i.value.trim()?i.insertAdjacentHTML("afterend",e("Please enter your Email")):i&&!a.test(i.value.trim())?i.insertAdjacentHTML("afterend",e("Invalid Email Address")):o&&!o.value.trim()?o.insertAdjacentHTML("afterend",e("Please enter your Mobile Number")):o&&!l.test(o.value.trim())?o.insertAdjacentHTML("afterend",e("Phone number must be 10 digits")):w?g&&!g.value.trim()?g.insertAdjacentHTML("afterend",e("Please enter your Date of Birth")):{firstName:f.value.trim(),lastName:p.value.trim(),email:i.value.trim(),phone:o.value.trim(),gender:w.value.trim(),dob:g.value.trim()}:E[0].closest(".gender-group").insertAdjacentHTML("beforeend",e("Please Select Your Gender"))}function Y(){return document.querySelectorAll(".alert").forEach(a=>a.remove()),b&&!b.value.trim()?b.parentElement.insertAdjacentHTML("afterend",e("Please Enter Your Old Password")):u&&!u.value.trim()?u.parentElement.insertAdjacentHTML("afterend",e("Please Enter New Password")):b.value.trim()===u.value.trim()?u.parentElement.insertAdjacentHTML("afterend",e("Old Password and New Password Should Not be Same")):m&&!m.value.trim()?m.parentElement.insertAdjacentHTML("afterend",e("Please Enter Your New Password Again")):u.value.trim()!==m.value.trim()?m.parentElement.insertAdjacentHTML("afterend",e("Your New PassWord and Confirm Password Should be Same")):{oldPassword:b.value.trim(),newPassword:u.value.trim(),confirmNewPassword:m.value.trim()}}const R=async()=>{const a=await C();if(a){a.providerData.some(l=>l.providerId==="google.com")&&(document.getElementById("change-password-tab").remove(),document.getElementById("change-password-tab-pane").remove());try{const l=j(P,"users",a.uid),w=await M(l);if(w.exists()){const d=w.data(),L=[...E].find(r=>r.value===d.gender);if(f&&(f.value=d.firstName||""),p&&(p.value=d.lastName||""),i&&(i.value=d.email||""),o&&(o.value=d.phone||""),L&&(L.checked=!0),g&&(g.value=d.dob||""),v&&v.addEventListener("click",async r=>{r.preventDefault();const t=V();if(v.disabled=!0,!(!t||typeof t!="object"))try{await N(l,{...t}),v.insertAdjacentHTML("beforebegin",e("Profile information updated successfully!","success"))}catch(n){console.log(n)}finally{v.disabled=!1}}),y){try{const r=S(P,"users",a.uid,"addresses"),t=await T(r);t.empty?y&&y.insertAdjacentHTML("afterbegin",e("You Have no Address")):t.forEach(n=>{const s=n.data();y.insertAdjacentHTML("afterbegin",`
                                    <div class="col-lg-4">
                                        <div class="h-100 px-3 py-4 border rounded-8 position-relative">
                                            ${s.default?s.default==="Shipping"?'<span class="fs-xs lh-1 fw-medium px-2 py-1 text-success bg-success-subtle rounded-16 position-absolute top-0 start-0 translate-middle-y ms-3">Default Shipping</span>':s.default==="Billing"?'<span class="fs-xs lh-1 fw-medium px-2 py-1 bg-warning-subtle rounded-16 position-absolute top-0 start-0 translate-middle-y ms-3">Default Billing</span>':"":""}
                                            <div class="d-flex align-items-center gap-2 fw-semibold mb-1">
                                                <span class="d-block flex-fill">${s.address}</span>
                                                <div class="dropdown flex-shrink-0">
                                                    <a href="javascript: void(0);" class="dropdown-toggle d-block" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                                                        <svg width="18" height="18" class="d-block">
                                                            <use href="./src/assets/images/sprite.svg#threeDotsVertical"></use>
                                                        </svg>
                                                    </a>
                                                    <ul class="dropdown-menu dropdown-menu-end fs-sm">
                                                        <li class="mb-0">
                                                            <a href="./add-address.html?addressId=${n.id}" class="edit-address dropdown-item d-flex align-items-center gap-1">
                                                                <svg width="16" height="16" class="d-block">
                                                                    <use href="./src/assets/images/sprite.svg#pencilSquare"></use>
                                                                </svg>
                                                                <span class="d-block">Edit</span>
                                                            </a>
                                                        </li>
                                                        <li class="mb-0">
                                                            <a href="javascript: void(0);" class="delete-address dropdown-item d-flex align-items-center gap-1" data-id="${n.id}">
                                                                <svg width="16" height="16" class="d-block">
                                                                    <use href="./src/assets/images/sprite.svg#delete"></use>
                                                                </svg>
                                                                <span class="d-block">Delete</span>
                                                            </a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                            <p class="fs-sm mb-0"><span class="d-inline-block text-gray-600">Country:</span> ${q.getCountryByCode(s.country).name}</p>
                                            <p class="fs-sm mb-0"><span class="d-inline-block text-gray-600">State:</span> ${F.getStateByCodeAndCountry(s.state,s.country).name}</p>
                                            <p class="fs-sm mb-0"><span class="d-inline-block text-gray-600">City:</span> ${s.city}</p>
                                            <p class="fs-sm mb-0"><span class="d-inline-block text-gray-600">ZIP:</span> ${s.zip}</p>
                                        </div>
                                    </div>
                                `)})}catch(r){console.log(r)}requestAnimationFrame(()=>{const r=document.querySelectorAll(".edit-address"),t=document.querySelectorAll(".delete-address");r&&r.forEach(n=>{}),t&&t.forEach(n=>{n.addEventListener("click",async s=>{s.preventDefault();const B=n.getAttribute("data-id");try{await x(j(P,"users",a.uid,"addresses",B)),n.closest(".col-lg-4").remove()}catch(H){console.log(H)}})})})}c&&c.addEventListener("submit",async r=>{r.preventDefault();const t=Y();if(t){const n=I.credential(a.email,t.oldPassword);try{h&&(h.disabled=!0),await k(a,n),await D(a,t.newPassword),c.insertAdjacentHTML("beforebegin",e("Password updated successfully!","success","mb-4")),await $()}catch(s){console.log(s),s.code==="auth/weak-password"?c.insertAdjacentHTML("beforebegin",e("Password should be at least 6 characters.","danger","mb-4")):s.code==="auth/invalid-credential"?c.insertAdjacentHTML("beforebegin",e("Old password is incorrect.","danger","mb-4")):c.insertAdjacentHTML("beforebegin",e(`Something went wrong: ${s.message}`,"danger","mb-4"))}finally{h&&(h.disabled=!1),c.reset()}}})}}catch(l){console.log(l)}}};R();
